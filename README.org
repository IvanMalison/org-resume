#+TITLE:  Curiculum Vitæ
#+AUTHOR: Xavier Garrido

* Introduction

A repository for my vitæ. It uses [[http://orgmode.org][org-mode]], a custom style sheet and a LaTeX
file style. The resume is done within [[file:resume.org][resume.org]] file. All styles are embedded
within this file and a =Makefile= is provided to produce the =html= and =pdf=
files.

* Project publish function

This section is used to publish the documentation to =html= and =pdf= in the
=pub/= directory.

This code defines the =publish-html-cv= and =publish-pdf-cv= which are used to
publish the CV into =html= and =pdf=, respectively.

** HTML export
*** Requirements
#+BEGIN_SRC emacs-lisp
  (require 'ox-html)
#+END_SRC
*** Building html postamble
#+NAME: html-postamble
#+BEGIN_SRC sh :tangle no :results output
  if [ -d .git ]; then
      LC_MESSAGES=en git --no-pager log -1 HEAD --date=short --pretty=format:"Last update %ad - commit %h"
  fi
#+END_SRC
*** Building html preamble
#+NAME: html-preamble
#+BEGIN_SRC sh :tangle no :results output
  preamble+='<div id=\"address\">'
  preamble+='<span class=\"name\">Xavier Garrido</span><br>'
  preamble+='<a href=\"http://www.lal.in2p3.fr\">Laboratoire de l'"'"'Accélérateur Linéaire</a><br>'
  preamble+='Paris-South University, Orsay<br>'
  preamble+='</div>'
  preamble+='<div id=\"contact\">'
  preamble+='<span class=\"name\">&nbsp;</span><br>'
  preamble+='(33) 1 64 46 84 28<br>'
  # preamble+='<a href=\"http://dan.iel.fm\">dan.iel.fm</a><br>'
  preamble+='<a href=\"mailto:garrido@lal.in2p3.fr\">garrido@lal.in2p3.fr</a>'
  preamble+='</div>'
  echo -ne $preamble
#+END_SRC
*** Project definition
#+BEGIN_SRC emacs-lisp :noweb yes
  (setq this-directory (file-name-directory (or load-file-name buffer-file-name)))
  (setq pub-directory (concat this-directory "pub/"))
  (unless (boundp 'org-publish-project-alist)
    (setq org-publish-project-alist nil))

  (setq org-publish-timestamp-directory "/tmp/org-timestamps")

  (setq org-html-style-default "")
  (setq org-html-htmlize-output-type 'css)

  (add-to-list
   'org-publish-project-alist
   `("publish-html-cv"
     :base-directory ,this-directory
     :base-extension "org"
     :publishing-directory ,(expand-file-name "html" pub-directory)
     :publishing-function org-html-publish-to-html
     :exclude ".*publish.*.org\\|README.org"
     :time-stamp-file nil
     :section-numbers nil
     :with-toc nil
     :html-head "<link rel=\"stylesheet\" href=\"stylesheets/styles.css\">
                 <link rel=\"stylesheet\" href=\"stylesheets/org-pygments.css\">"
     :html-preamble  "<<html-preamble()>>"
     :html-postamble "<<html-postamble()>>"
     :html-head-include-scripts nil))
#+END_SRC

*** CSS stylesheets                                              :noexport:
**** Main stylesheets
:PROPERTIES:
:TANGLE:   pub/html/stylesheets/styles.css
:END:
***** Google fonts
#+BEGIN_SRC css
  @import url(https://fonts.googleapis.com/css?family=Lato:300italic,700italic,300,700);
  @import url(https://fonts.googleapis.com/css?family=Inconsolata);
#+END_SRC

***** Main =css= definitions
****** Body
#+BEGIN_SRC css
  body {
      width:800px;
      margin:50px auto;
      font:14px/1.5 Lato, "Helvetica Neue", Helvetica, Arial, sans-serif;
      color:#777;
      font-weight:300;
  }
#+END_SRC

****** Headline
#+BEGIN_SRC css
  h1, h2, h3, h4, h5, h6 {
      color:#777777;
      margin:0 0 20px;
  }

  h1, h2, h3 {
      line-height:1.1;
  }

  h1 {
      font-family:Lobster;
      text-shadow: 0 0 2px #777;
      font-size: 48px;
      display: none;
  }

  h3, h4, h5, h6 {
      font-style: italic;
  }
#+END_SRC

****** Link
#+BEGIN_SRC css
  a {
      color:#39c;
      font-weight:400;
      text-decoration:none;
  }

  a:hover {
      color:#069;
  }

  a small {
      font-size:11px;
      color:#777;
      margin-top:-0.6em;
      display:block;
  }

  a:hover small {
      color:#777;
  }
#+END_SRC

****** Code, table, image
#+BEGIN_SRC css
  p, ul, ol, table, pre, dl {
      margin:0 0 20px;
  }

  blockquote {
      border-left:1px solid #e5e5e5;
      width:600px;
      padding:0 0 0 20px;
      font-style:italic;
  }

  code, pre {
      font-family:Inconsolata, Monaco, Bitstream Vera Sans Mono, Lucida Console, Terminal;
      color:#777;
      font-size:12px;
  }

  pre {
      padding:8px 15px;
      background: #f8f8f8;
      border-radius:5px;
      border:1px solid #e5e5e5;
      overflow-x: auto;
  }

  table {
      width:80%;
      border-collapse:collapse;
      margin-left:auto;
      margin-right:auto;
  }

  th, td {
      text-align:left;
      padding:5px 10px;
      border-bottom:1px solid #e5e5e5;
  }

  dt {
      color:#444;
      font-weight:700;
  }

  th {
      color:#444;
  }

  img {
      max-width:100%;
  }
#+END_SRC
****** Misc. (bold, =hr= style)
#+BEGIN_SRC css
  #content {
      width:700px;
      float:right;
      padding-bottom:50px;
  /* border:1px solid #e5e5e5; */
  /* border-width:1px 0; */
  /* padding:20px 0; */
  /* margin:0 0 20px; */
  }

  strong {
      color:#222;
      font-weight:700;
  }
  small {
      font-size:11px;
  }

  hr {
      border:0;
      background:#e5e5e5;
      height:1px;
      margin:0 0 20px;
  }

  .footpara {
      display: inline;
  }
#+END_SRC

****** Scrollbars
#+BEGIN_SRC css
  .scrollbar-container {
      position: absolute;
      top: 0; bottom: 0; left: 0; right: 0;
      margin: 20px;

      border: 4px solid rgba(0, 0, 0, 0.2);
      overflow: auto;
      background-color: whiteSmoke;
  }
  .scrollbar-container .inner {
      height: 2011px;
      width: 1985px;
      padding: 1em;
      background-color: white;
      font-family: sans-serif;
  }
  ::-webkit-scrollbar {
      background: transparent;
  }
  ::-webkit-scrollbar-thumb {
      background-color: rgba(0, 0, 0, 0.2);
      border: solid whiteSmoke 4px;
      border-radius:15px;
  }
  ::-webkit-scrollbar-thumb:hover {
      background-color: rgba(0, 0, 0, 0.3);
  }
#+END_SRC

****** Preamble, postamble
#+BEGIN_SRC css
  #preamble:before, #preamble:after {
      display: table;
      content: "";
  }

  #preamble:after {
      clear: both;
  }

  #postamble {
      margin-top: 10px;
      text-align: center;
      font-size: 11px;
      clear: both;
  }

  #address {
      float: left;
  }

  #contact {
      float: right;
      text-align: right;
  }

  .name {
      font-size: 20px;
      line-height: 22px;
      font-weight: 600;
  }
#+END_SRC

****** Adapting media source
#+BEGIN_SRC css
  @media print, screen and (max-width: 960px) {

      body {
          width:auto;
          margin:0;
      }

      header, content, footer {
          float:none;
          position:static;
          width:auto;
      }

      header {
          padding-right:320px;
      }

      header a small {
          display:inline;
      }

      header ul {
          position:absolute;
          right:50px;
          top:52px;
      }
  }

  @media print, screen and (max-width: 720px) {
      body {
          word-wrap:break-word;
      }

      header {
          padding:0;
      }

      header ul, header p.view {
          position:static;
      }

      pre, code {
          word-wrap:normal;
      }
  }

  @media print, screen and (max-width: 480px) {
      body {
          padding:15px;
      }

      header ul {
          display:none;
      }
  }

  @media print {
      body {
          padding:0.4in;
          font-size:12pt;
          color:#444;
      }
  }
#+END_SRC

**** Org source code styles
:PROPERTIES:
:TANGLE: pub/html/stylesheets/org-pygments.css
:END:

#+BEGIN_SRC css
  .org-string,
  .org-type {
      color: #DEB542;
  }

  .org-builtin,
  .org-variable-name,
  .org-constant,
  .org-function-name {
      color: #69B7F0;
  }

  .org-comment,
  .org-comment-delimiter,
  .org-doc {
      color: #93a1a1;
  }

  .org-keyword {
      color: #D33682;
  }

  pre {
      color: #777777;
  }
#+END_SRC

** Exporter functions
#+BEGIN_SRC emacs-lisp
  (defun org-publish-html ()
    (progn
      (org-publish-project "publish-html-cv" 'force)
      (rename-file (expand-file-name "resume.html" (expand-file-name "html" pub-directory))
                   (expand-file-name "index.html" (expand-file-name "html" pub-directory)) t)
      ))
#+END_SRC

#+BEGIN_SRC emacs-lisp
  (defun org-publish-pdf ()
    (progn
      (org-publish-project "publish-pdf-cv" 'force)
      (shell-command "mkdir -p pub/latex.d && mv *.{tex,auxlock,toc,out,fls,aux,pdf,log,fdb_latexmk,sty} pub/latex.d/.")
      ))
#+END_SRC
